paths:
  /auth/admin/register:
    post:
      tags: [Auth - Admin]
      summary: Register a new admin (requires admin auth)
      description: Register a new admin user with optional multiple roles
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name: { type: string }
                email: { type: string, format: email }
                password: { type: string, format: password }
                roleIds:
                  type: array
                  items:
                    type: string
                  description: Optional array of role IDs to assign to admin
                  example: ['role-uuid-1', 'role-uuid-2']
      responses:
        '200': { description: Admin registered }
        '409': { description: Email exists }
        '401': { description: Unauthorized }
  /auth/admin/login:
    post:
      tags: [Auth - Admin]
      summary: Admin login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: admin@gmail.com
                password:
                  type: string
                  format: password
                  example: secret
      responses:
        '200':
          description: Login success with tokens and admin user
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken: { type: string }
                  refreshToken: { type: string }
                  user:
                    $ref: '#/components/schemas/AdminUser'
                required: [accessToken, refreshToken, user]
        '400': { description: Invalid credentials }
  /auth/admin/me:
    get:
      tags: [Auth - Admin]
      summary: Current admin profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Admin profile with role and permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminUser'
        '401': { description: Unauthorized }
  /auth/admin/refresh:
    post:
      tags: [Auth - Admin]
      summary: Refresh admin tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refreshToken]
              properties:
                refreshToken: { type: string }
      responses:
        '200': { description: Tokens refreshed }
        '400': { description: Invalid refresh token }
  /auth/admin/logout:
    post:
      tags: [Auth - Admin]
      summary: Admin logout (stateless)
      responses:
        '200': { description: Logged out }
  /auth/admin/reset-password:
    post:
      tags: [Auth - Admin]
      summary: Reset admin password by email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, newPassword]
              properties:
                email: { type: string, format: email }
                newPassword: { type: string }
      responses:
        '200': { description: Password reset }
  /auth/admin/change-password:
    post:
      tags: [Auth - Admin]
      summary: Change admin password (authenticated)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [oldPassword, newPassword]
              properties:
                oldPassword: { type: string }
                newPassword: { type: string }
      responses:
        '200': { description: Password changed }
        '401': { description: Unauthorized }

components:
  schemas:
    AdminPermission:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
      required: [id, name]
      example:
        id: 'perm-uuid-123'
        name: 'admin.create'

    AdminRole:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        permissions:
          type: array
          items: { $ref: '#/components/schemas/AdminPermission' }
      required: [id, name]
      example:
        id: 'role-uuid-123'
        name: 'admin'
        permissions:
          - id: 'perm-uuid-1'
            name: 'admin.read'
          - id: 'perm-uuid-2'
            name: 'admin.create'

    AdminUser:
      type: object
      description: |
        Admin user object with multiple roles support.
        - roles: Array of all assigned roles (only for isAdmin=true users)
        - permissions: Flattened array of unique permission names from all roles
        - isSuperAdmin: true for superadmin@gmail.com (bypasses all permission checks)
      properties:
        id: { type: string }
        name: { type: string }
        email: { type: string, format: email }
        avatar: { type: string, nullable: true }
        isActive: { type: boolean }
        isAdmin: { type: boolean }
        roles:
          type: array
          description: Array of assigned roles with their permissions (empty for non-admin users)
          items: { $ref: '#/components/schemas/AdminRole' }
        permissions:
          type: array
          description: Flattened array of unique permission names combined from all roles
          items: { type: string }
          example: ['admin.read', 'admin.create', 'post.read', 'post.create']
        isSuperAdmin:
          type: boolean
          description: True for superadmin@gmail.com (bypasses all permission checks)
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
      required: [id, name, email, isActive, isAdmin, roles, permissions, isSuperAdmin]
      example:
        id: 'user-uuid-123'
        name: 'Admin User'
        email: 'admin@gmail.com'
        avatar: 'https://example.com/avatar.jpg'
        isActive: true
        isAdmin: true
        roles:
          - id: 'role-uuid-1'
            name: 'admin'
            permissions:
              - id: 'perm-uuid-1'
                name: 'admin.read'
              - id: 'perm-uuid-2'
                name: 'admin.create'
              - id: 'perm-uuid-3'
                name: 'admin.update'
          - id: 'role-uuid-2'
            name: 'editor'
            permissions:
              - id: 'perm-uuid-4'
                name: 'post.read'
              - id: 'perm-uuid-5'
                name: 'post.create'
              - id: 'perm-uuid-6'
                name: 'post.update'
        permissions:
          - 'admin.read'
          - 'admin.create'
          - 'admin.update'
          - 'post.read'
          - 'post.create'
          - 'post.update'
        isSuperAdmin: false
        createdAt: '2025-10-31T10:00:00Z'
        updatedAt: '2025-10-31T10:00:00Z'
