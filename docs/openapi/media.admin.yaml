components:
  schemas:
    MediaFile:
      type: object
      properties:
        fileId: { type: string }
        name: { type: string }
        url: { type: string, format: uri }
        filePath: { type: string }
        size: { type: integer }
        fileType: { type: string }
        type: { type: string, enum: [file] }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        tags:
          type: array
          items: { type: string }
    MediaFolder:
      type: object
      properties:
        folderId: { type: string }
        name: { type: string }
        folderPath: { type: string }
        type: { type: string, enum: [folder] }
        createdAt: { type: string, format: date-time }
    MediaLibraryResponse:
      type: object
      properties:
        items:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/MediaFile'
              - $ref: '#/components/schemas/MediaFolder'
        folders:
          type: array
          items: { $ref: '#/components/schemas/MediaFolder' }
        files:
          type: array
          items: { $ref: '#/components/schemas/MediaFile' }
        page: { type: integer }
        perPage: { type: integer }
        hasMore: { type: boolean }
        totalEstimate: { type: integer }
        currentPath: { type: string }
    MediaStructureResponse:
      type: object
      properties:
        totalFiles: { type: integer }
        totalFolders: { type: integer }
        files:
          type: array
          items: { $ref: '#/components/schemas/MediaFile' }
        folders:
          type: array
          items: { $ref: '#/components/schemas/MediaFolder' }
        structure:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/MediaFile'
              - $ref: '#/components/schemas/MediaFolder'
    SuccessResponse:
      type: object
      properties:
        success: { type: boolean }
        message: { type: string }
    FolderCreateResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            folder: { $ref: '#/components/schemas/MediaFolder' }
            path: { type: string }
    FileUpdateResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            file: { $ref: '#/components/schemas/MediaFile' }
    DeleteResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            deletedFiles: { type: integer }
            deletedFolders: { type: integer }
    DeleteItemResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            type: { type: string, enum: [file, folder] }
            fileId: { type: string }
            fileName: { type: string }
            folderPath: { type: string }
    BulkOperationResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            totalFiles: { type: integer }
            successful: { type: integer }
            failed: { type: integer }
            results:
              type: array
              items:
                type: object
                properties:
                  fileId: { type: string }
                  success: { type: boolean }
                  error: { type: string }
    FileDetailsResponse:
      type: object
      properties:
        success: { type: boolean }
        file: { $ref: '#/components/schemas/MediaFile' }
    SearchResponse:
      type: object
      properties:
        items:
          type: array
          items: { $ref: '#/components/schemas/MediaFile' }
        page: { type: integer }
        perPage: { type: integer }
        hasMore: { type: boolean }
        totalEstimate: { type: integer }
        searchQuery: { type: string }
        filters:
          type: object
          properties:
            tags: { type: array, items: { type: string } }
            fileType: { type: string }
            path: { type: string }
            dateFrom: { type: string }
            dateTo: { type: string }

paths:
  /admin/media:
    get:
      tags: [Media - Admin]
      summary: List media files and folders
      description: Get paginated list of files and folders with filtering options
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: path
          schema: { type: string, default: '/' }
          description: Folder path to browse (e.g., '/', '/gallery', '/documents')
          example: '/gallery'
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
          description: Page number for pagination
        - in: query
          name: perPage
          schema: { type: integer, minimum: 1, maximum: 100, default: 50 }
          description: Number of items per page
        - in: query
          name: fileType
          schema:
            type: string
            enum: [all, image, video, audio, raw]
            default: all
          description: Filter by file type
        - in: query
          name: withItems
          schema: { type: string, enum: ['true', 'false'] }
          description: Include first 4 items from each folder in the response
          example: 'true'
      responses:
        '200':
          description: Media library content retrieved successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MediaLibraryResponse' }
        '400': { description: Invalid request parameters }
        '401': { description: Unauthorized }
        '500': { description: Server error }

  /admin/media/{id}:
    delete:
      tags: [Media - Admin]
      summary: Delete a file or folder (unified endpoint)
      description: |
        Automatically detects if the ID is a fileId or folderId and deletes accordingly.
        This is the recommended endpoint for deleting media items as it handles both files and folders.
        For folders, use ?force=true to delete non-empty folders with all contents.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
          description: File ID or Folder ID to delete
          example: 'abc123def456'
        - in: query
          name: force
          schema: { type: boolean, default: false }
          description: Force delete folder with all contents (only for folders)
      responses:
        '200':
          description: Item deleted successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/DeleteItemResponse' }
              examples:
                fileDeleted:
                  value:
                    success: true
                    type: file
                    fileId: abc123def456
                    fileName: image.jpg
                    message: File "image.jpg" deleted successfully
                folderDeleted:
                  value:
                    success: true
                    type: folder
                    folderPath: /my-folder
                    message: Folder "/my-folder" deleted successfully
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '404': { description: Item not found }
        '500': { description: Server error }

  /admin/media/structure:
    get:
      tags: [Media - Admin]
      summary: Get complete media library structure
      description: Returns overview of entire media library with counts and structure
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Media library structure retrieved successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/MediaStructureResponse' }
        '401': { description: Unauthorized }
        '500': { description: Server error }

  /admin/media/search:
    get:
      tags: [Media - Admin]
      summary: Search media files
      description: Search and filter media files by name, tags, type, path, and date range
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: searchQuery
          schema: { type: string }
          description: Search by filename
          example: 'vacation'
        - in: query
          name: tags
          schema: { type: string }
          description: Filter by tags (comma-separated)
          example: 'nature,landscape'
        - in: query
          name: fileType
          schema: { type: string, enum: [all, image, video, audio, raw] }
          description: Filter by file type
        - in: query
          name: path
          schema: { type: string }
          description: Filter by folder path
        - in: query
          name: dateFrom
          schema: { type: string, format: date }
          description: Filter files created after this date
        - in: query
          name: dateTo
          schema: { type: string, format: date }
          description: Filter files created before this date
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: perPage
          schema: { type: integer, minimum: 1, maximum: 100, default: 50 }
      responses:
        '200':
          description: Search results retrieved successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/SearchResponse' }
        '400': { description: Invalid request parameters }
        '401': { description: Unauthorized }
        '500': { description: Server error }

  /admin/media/folder:
    post:
      tags: [Media - Admin]
      summary: Create a new folder
      description: Create a new folder with unique name validation
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                folderName:
                  type: string
                  minLength: 1
                  maxLength: 50
                  description: Name of the folder to create
                  example: 'vacation-photos'
                parentPath:
                  type: string
                  default: '/'
                  description:
                    Parent directory path where the new folder will be created. If browsing
                    '/gallery', set this to '/gallery' to create a subfolder inside it.
                  example: '/gallery'
              required: [folderName]
            examples:
              rootFolder:
                summary: Create folder in root
                value:
                  folderName: 'documents'
              nestedFolder:
                summary: Create nested folder inside gallery
                value:
                  folderName: 'vacation-photos'
                  parentPath: '/gallery'
      responses:
        '201':
          description: Folder created successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FolderCreateResponse' }
        '400': { description: Invalid request or folder already exists }
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '500': { description: Server error }

  /admin/media/rename:
    put:
      tags: [Media - Admin]
      summary: Rename a file or folder (unified endpoint)
      description: |
        Unified endpoint for renaming both files and folders.
        Automatically detects the type based on the ID:
        - If ID starts with '/', it's treated as a folder path
        - Otherwise, it's treated as a file ID
        You can also explicitly specify the type if needed.
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  description: File ID or folder path to rename
                  example: 'abc123def456'
                newName:
                  type: string
                  minLength: 1
                  maxLength: 100
                  description: New name for the item
                  example: 'new-name'
                type:
                  type: string
                  enum: [file, folder]
                  description: Optional - explicitly specify item type (auto-detected if omitted)
              required: [id, newName]
            examples:
              renameFile:
                summary: Rename a file (auto-detect)
                value:
                  id: 'abc123def456'
                  newName: 'beach-sunset'
              renameFolder:
                summary: Rename a folder (auto-detect)
                value:
                  id: '/vacation/photos'
                  newName: 'summer-2024'
              renameFileExplicit:
                summary: Rename a file (explicit type)
                value:
                  id: 'abc123def456'
                  newName: 'company-logo'
                  type: 'file'
              renameFolderExplicit:
                summary: Rename a folder (explicit type)
                value:
                  id: '/projects'
                  newName: 'archived-projects'
                  type: 'folder'
      responses:
        '200':
          description: Item renamed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      oldPath: { type: string }
                      newPath: { type: string }
                      file: { $ref: '#/components/schemas/MediaFile' }
              examples:
                fileRenamed:
                  value:
                    success: true
                    file:
                      fileId: abc123def456
                      name: new-filename
                      url: https://example.com/new-filename.jpg
                    message: File renamed to "new-filename" successfully
                folderRenamed:
                  value:
                    success: true
                    oldPath: /albums/vacation-photos
                    newPath: /albums/summer-vacation
                    message:
                      Folder renamed from "/albums/vacation-photos" to "/albums/summer-vacation"
        '400': { description: Invalid request or name conflict }
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '404': { description: Item not found }
        '500': { description: Server error }

  /admin/media/folder/move:
    put:
      tags: [Media - Admin]
      summary: Move a folder
      description: Move a folder to a different location
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sourcePath:
                  type: string
                  description: Current full path of the folder
                  example: '/albums/vacation'
                destinationPath:
                  type: string
                  description: Destination path where folder will be moved
                  example: '/archived'
              required: [sourcePath, destinationPath]
      responses:
        '200':
          description: Folder moved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      oldPath: { type: string }
                      newPath: { type: string }
        '400': { description: Invalid request }
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '404': { description: Folder not found }
        '500': { description: Server error }

  /admin/media/folder/copy:
    put:
      tags: [Media - Admin]
      summary: Copy a folder
      description: Copy a folder to a different location
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sourcePath:
                  type: string
                  description: Current full path of the folder
                  example: '/albums/vacation'
                destinationPath:
                  type: string
                  description: Destination path where folder will be copied
                  example: '/backup'
              required: [sourcePath, destinationPath]
      responses:
        '200':
          description: Folder copied successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      sourcePath: { type: string }
                      destinationPath: { type: string }
        '400': { description: Invalid request }
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '404': { description: Folder not found }
        '500': { description: Server error }

  /admin/media/file/{fileId}:
    get:
      tags: [Media - Admin]
      summary: Get file details
      description: Retrieve complete information about a specific file
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: fileId
          required: true
          schema: { type: string }
          description: Unique identifier of the file
          example: 'abc123def456'
      responses:
        '200':
          description: File details retrieved successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FileDetailsResponse' }
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '404': { description: File not found }
        '500': { description: Server error }
    put:
      tags: [Media - Admin]
      summary: Update file details
      description: Update file metadata like name and tags
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: fileId
          required: true
          schema: { type: string }
          description: Unique identifier of the file
          example: 'abc123def456'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: New name for the file
                  example: 'updated-filename'
                tags:
                  type: array
                  items: { type: string }
                  description: Tags to associate with the file
                  example: ['nature', 'landscape', 'photography']
            examples:
              updateName:
                summary: Update file name only
                value:
                  name: 'new-filename'
              updateTags:
                summary: Update tags only
                value:
                  tags: ['nature', 'landscape']
              updateBoth:
                summary: Update name and tags
                value:
                  name: 'mountain-view'
                  tags: ['nature', 'mountain', 'landscape']
      responses:
        '200':
          description: File updated successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/FileUpdateResponse' }
        '400': { description: Invalid request parameters }
        '401': { description: Unauthorized }
        '403': { description: Insufficient permissions }
        '404': { description: File not found }
        '500': { description: Server error }
