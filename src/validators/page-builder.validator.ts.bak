import { z } from 'zod'

// Component Schema
export const componentSchema = z.object({
  id: z.string().uuid().optional(),
  type: z.string().min(1, 'Component type is required'),
  order: z.number().int().min(0).default(0),
  props: z.record(z.string(), z.any()), // Component-specific configuration
})

// Column Schema
export const columnSchema = z.object({
  id: z.string().uuid().optional(),
  width: z.number().int().min(1).max(12).default(12),
  order: z.number().int().min(0).default(0),
  settings: z.record(z.string(), z.any()).optional(),
  components: z.array(componentSchema).optional().default([]),
})

// Row Schema
export const rowSchema = z.object({
  id: z.string().uuid().optional(),
  order: z.number().int().min(0).default(0),
  settings: z.record(z.string(), z.any()).optional(),
  columns: z.array(columnSchema).optional().default([]),
})

// Section Schema
export const sectionSchema = z.object({
  id: z.string().uuid().optional(),
  name: z.string().min(1, 'Section name is required'),
  order: z.number().int().min(0).default(0),
  settings: z.record(z.string(), z.any()).optional(),
  rows: z.array(rowSchema).optional().default([]),
})

// SEO Schema
export const seoSchema = z.object({
  title: z.string().optional(),
  description: z.string().optional(),
  keywords: z.array(z.string()).optional(),
  ogTitle: z.string().optional(),
  ogDescription: z.string().optional(),
  ogImage: z.string().url().optional(),
  canonical: z.string().url().optional(),
})

// Create Page Builder Validation
export const createPageBuilderSchema = z.object({
  body: z.object({
    title: z.string().min(1, 'Page title is required').max(200),
    slug: z
      .string()
      .min(1, 'Slug is required')
      .max(200)
      .regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, 'Invalid slug format'),
    description: z.string().optional(),
    sections: z.array(sectionSchema).optional().default([]),
    seo: seoSchema.optional(),
    isPublished: z.boolean().default(false),
  }),
})

// Update Page Builder Validation
export const updatePageBuilderSchema = z.object({
  params: z.object({
    id: z.string().uuid('Invalid page ID'),
  }),
  body: z.object({
    title: z.string().min(1).max(200).optional(),
    slug: z
      .string()
      .min(1)
      .max(200)
      .regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, 'Invalid slug format')
      .optional(),
    description: z.string().optional(),
    sections: z.array(sectionSchema).optional(),
    seo: seoSchema.optional(),
    isPublished: z.boolean().optional(),
  }),
})

// Get Page Builder by ID/Slug Validation
export const getPageBuilderSchema = z.object({
  params: z.object({
    identifier: z.string().min(1, 'Page ID or slug is required'),
  }),
})

// Delete Page Builder Validation
export const deletePageBuilderSchema = z.object({
  params: z.object({
    id: z.string().uuid('Invalid page ID'),
  }),
})

// Add Section Validation
export const addSectionSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
  }),
  body: sectionSchema.omit({ id: true }),
})

// Update Section Validation
export const updateSectionSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
  }),
  body: sectionSchema.omit({ id: true }).partial(),
})

// Delete Section Validation
export const deleteSectionSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
  }),
})

// Add Row Validation
export const addRowSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
  }),
  body: rowSchema.omit({ id: true }),
})

// Update Row Validation
export const updateRowSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
  }),
  body: rowSchema.omit({ id: true }).partial(),
})

// Delete Row Validation
export const deleteRowSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
  }),
})

// Add Column Validation
export const addColumnSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
  }),
  body: columnSchema.omit({ id: true }),
})

// Update Column Validation
export const updateColumnSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
    columnId: z.string().uuid('Invalid column ID'),
  }),
  body: columnSchema.omit({ id: true }).partial(),
})

// Delete Column Validation
export const deleteColumnSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
    columnId: z.string().uuid('Invalid column ID'),
  }),
})

// Add Component Validation
export const addComponentSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
    columnId: z.string().uuid('Invalid column ID'),
  }),
  body: componentSchema.omit({ id: true }),
})

// Update Component Validation
export const updateComponentSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
    columnId: z.string().uuid('Invalid column ID'),
    componentId: z.string().uuid('Invalid component ID'),
  }),
  body: componentSchema.omit({ id: true }).partial(),
})

// Delete Component Validation
export const deleteComponentSchema = z.object({
  params: z.object({
    pageId: z.string().uuid('Invalid page ID'),
    sectionId: z.string().uuid('Invalid section ID'),
    rowId: z.string().uuid('Invalid row ID'),
    columnId: z.string().uuid('Invalid column ID'),
    componentId: z.string().uuid('Invalid component ID'),
  }),
})

// Duplicate Page Validation
export const duplicatePageBuilderSchema = z.object({
  params: z.object({
    id: z.string().uuid('Invalid page ID'),
  }),
  body: z.object({
    title: z.string().min(1, 'New page title is required'),
    slug: z
      .string()
      .min(1, 'New slug is required')
      .regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, 'Invalid slug format'),
  }),
})

// Query validation for listing pages
export const listPageBuildersSchema = z.object({
  query: z.object({
    isPublished: z
      .string()
      .transform((val) => val === 'true')
      .optional(),
    search: z.string().optional(),
    page: z
      .string()
      .transform((val) => parseInt(val, 10))
      .pipe(z.number().int().min(1))
      .optional()
      .default(() => 1),
    limit: z
      .string()
      .transform((val) => parseInt(val, 10))
      .pipe(z.number().int().min(1).max(100))
      .optional()
      .default(() => 10),
  }),
})

export type CreatePageBuilderInput = z.infer<typeof createPageBuilderSchema>
export type UpdatePageBuilderInput = z.infer<typeof updatePageBuilderSchema>
export type GetPageBuilderInput = z.infer<typeof getPageBuilderSchema>
export type DeletePageBuilderInput = z.infer<typeof deletePageBuilderSchema>
export type AddSectionInput = z.infer<typeof addSectionSchema>
export type UpdateSectionInput = z.infer<typeof updateSectionSchema>
export type DeleteSectionInput = z.infer<typeof deleteSectionSchema>
export type AddRowInput = z.infer<typeof addRowSchema>
export type UpdateRowInput = z.infer<typeof updateRowSchema>
export type DeleteRowInput = z.infer<typeof deleteRowSchema>
export type AddColumnInput = z.infer<typeof addColumnSchema>
export type UpdateColumnInput = z.infer<typeof updateColumnSchema>
export type DeleteColumnInput = z.infer<typeof deleteColumnSchema>
export type AddComponentInput = z.infer<typeof addComponentSchema>
export type UpdateComponentInput = z.infer<typeof updateComponentSchema>
export type DeleteComponentInput = z.infer<typeof deleteComponentSchema>
export type DuplicatePageBuilderInput = z.infer<typeof duplicatePageBuilderSchema>
export type ListPageBuildersInput = z.infer<typeof listPageBuildersSchema>
